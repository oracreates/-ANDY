<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sipp - Your Pixels, Your Identity</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body { margin: 0; padding: 0; }
.pixelated {
    image-rendering: pixelated;
    image-rendering: crisp-edges;
}
</style>
</head>

<body>
<div class="min-h-screen bg-gradient-to-br from-yellow-200 via-pink-200 to-purple-300 flex items-center justify-center p-4">

<div class="max-w-2xl w-full bg-white/20 backdrop-blur-lg rounded-2xl shadow-2xl p-8 border border-white/30">

<!-- Header -->
<div class="text-center mb-6">
<h1 class="text-5xl font-bold text-purple-900 mb-1">Sipp</h1>
<p class="text-purple-800 italic text-lg">Your pixels, your identity</p>
</div>

<!-- NOT CONNECTED -->
<div id="notConnected" class="flex flex-col items-center space-y-6">
<button id="connectSolflareBtn"
class="px-8 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold rounded-lg shadow-lg hover:scale-105 transition">
Connect Solflare Wallet
</button>
<p id="walletStatus" class="text-sm"></p>
</div>

<!-- CONNECTED -->
<div id="connected" class="space-y-6 hidden">

<div class="bg-white/10 rounded-lg p-4 border border-white/20">
<p class="text-sm text-purple-800 mb-1">Your Wallet</p>
<p id="walletAddress" class="text-purple-900 font-mono text-sm break-all"></p>
</div>

<div class="flex flex-col items-center space-y-4">

<canvas id="pixelCanvas" class="rounded-lg pixelated"></canvas>

<div id="downloadLinkContainer" class="hidden w-full bg-white/10 rounded-lg p-4 border border-white/20">
<p class="text-sm text-purple-800 mb-2 font-semibold">Your Download Link</p>
<div class="flex gap-2">
<input id="downloadLinkInput" readonly
class="flex-1 px-3 py-2 bg-white/60 rounded text-xs font-mono"/>
<button id="copyLinkBtn"
class="px-4 py-2 bg-purple-500 text-white rounded">Copy</button>
</div>
<p class="text-xs text-purple-700 mt-2">
üìã Paste this link into Chrome or Safari
</p>
</div>

<button id="downloadBtn"
class="px-6 py-3 bg-green-500 text-white rounded-lg hover:scale-105 transition">
Generate Download Link
</button>

<button id="regenerateBtn" class="text-sm underline text-purple-800">
Regenerate ($0.5)
</button>

<button id="disconnectBtn"
class="px-6 py-3 bg-red-500 text-white rounded-lg hover:scale-105 transition">
Disconnect
</button>

</div>
</div>
</div>
</div>

<script>
let walletAddress = null;

/* Detect Solflare */
window.onload = () => {
const status = document.getElementById("walletStatus");
if (window.solflare) {
status.textContent = "‚úÖ Solflare detected";
status.className = "text-green-700";
} else {
status.textContent = "‚ö†Ô∏è Install Solflare wallet";
status.className = "text-red-700";
}
};

/* Connect Wallet */
async function connectSolflare() {
if (!window.solflare) {
window.open("https://solflare.com", "_blank");
return;
}
await window.solflare.connect();
walletAddress = window.solflare.publicKey.toString();

document.getElementById("walletAddress").textContent = walletAddress;
document.getElementById("notConnected").classList.add("hidden");
document.getElementById("connected").classList.remove("hidden");

generatePixelArt(walletAddress);
}

/* Disconnect */
function disconnectWallet() {
walletAddress = null;
document.getElementById("connected").classList.add("hidden");
document.getElementById("notConnected").classList.remove("hidden");
}

/* Simple seeded RNG */
function hashSeed(str) {
let h = 0;
for (let i = 0; i < str.length; i++) {
h = str.charCodeAt(i) + ((h << 5) - h);
}
return Math.abs(h);
}

/* Generate Pixel Art */
function generatePixelArt(seedStr) {
const canvas = document.getElementById("pixelCanvas");
const ctx = canvas.getContext("2d");
const seed = hashSeed(seedStr);
const size = 24;
const px = 16;

canvas.width = size * px;
canvas.height = size * px;

ctx.fillStyle = `hsl(${seed % 360},70%,60%)`;
ctx.fillRect(0,0,canvas.width,canvas.height);

for (let y = 6; y < 16; y++) {
for (let x = 7; x < 17; x++) {
ctx.fillStyle = `hsl(${(seed+x*y)%360},60%,50%)`;
ctx.fillRect(x*px,y*px,px,px);
}
}
}

/* Convert dataURL to Blob */
function dataURLtoBlob(dataurl) {
const arr = dataurl.split(",");
const mime = arr[0].match(/:(.*?);/)[1];
const bstr = atob(arr[1]);
let n = bstr.length;
const u8 = new Uint8Array(n);
while(n--) u8[n] = bstr.charCodeAt(n);
return new Blob([u8], { type: mime });
}

/* Generate Download */
function downloadNFT() {
const canvas = document.getElementById("pixelCanvas");
const dataURL = canvas.toDataURL("image/png");
const blob = dataURLtoBlob(dataURL);
const url = URL.createObjectURL(blob);

document.getElementById("downloadLinkInput").value = url;
document.getElementById("downloadLinkContainer").classList.remove("hidden");

if (!/Solflare/i.test(navigator.userAgent)) {
window.open(url, "_blank");
} else {
alert("Open link in Chrome or Safari");
}
}

/* Copy */
function copyLink() {
const input = document.getElementById("downloadLinkInput");
input.select();
document.execCommand("copy");
}

/* Events */
connectSolflareBtn.onclick = connectSolflare;
disconnectBtn.onclick = disconnectWallet;
downloadBtn.onclick = downloadNFT;
copyLinkBtn.onclick = copyLink;
regenerateBtn.onclick = () => generatePixelArt(walletAddress);
</script>

</body>
</html>