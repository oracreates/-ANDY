<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIPP</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body { margin:0; padding:0; font-family:sans-serif; background:#0B0F1A; }
    .pixelated { image-rendering: pixelated; image-rendering: -moz-crisp-edges; image-rendering: crisp-edges; }
    button { cursor:pointer; }
</style>
</head>
<body>
<div id="app" class="min-h-screen flex items-center justify-center p-4">
    <div class="max-w-2xl w-full bg-white/10 backdrop-blur-lg rounded-2xl shadow-2xl p-8 border border-white/20">
        <div class="text-center mb-6">
            <h1 class="text-4xl font-bold text-[#EAEAF0] mb-2">SIPP</h1>
            <p class="text-[#A1A1B3]">Wallet-signed pixel identity</p>
        </div>

        <!-- Not connected -->
        <div id="notConnected" class="flex flex-col items-center space-y-4">
            <button id="connectSolflareBtn" class="px-8 py-4 bg-[#7C5CFF] text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
                Connect Solflare Wallet
            </button>
            <div id="walletStatus" class="text-sm text-yellow-300 mt-2"></div>
        </div>

        <!-- Connected -->
        <div id="connected" class="space-y-6" style="display:none;">
            <p class="text-[#A1A1B3]">Connected Wallet: <span id="walletAddress" class="font-mono text-white"></span></p>
            <button id="payBtn" class="px-6 py-3 bg-[#4DEEEA] text-black font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
                Create SIPP ($1)
            </button>

            <div id="pixelContainer" class="flex flex-col items-center space-y-4" style="display:none;">
                <div class="bg-white/10 p-6 rounded-xl border-4 border-white/20 shadow-2xl">
                    <canvas id="pixelCanvas" class="rounded-lg pixelated"></canvas>
                </div>
                <div class="flex gap-4">
                    <button id="downloadBtn" class="px-6 py-3 bg-[#A6FF00] text-black font-semibold rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200">
                        Download PFP
                    </button>
                    <button id="regenerateBtn" class="px-6 py-3 bg-[#FF7AD9] text-black font-semibold rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200">
                        Regenerate ($0.5)
                    </button>
                </div>
                <p class="text-[#A1A1B3] text-sm mt-2">Traits: <span id="traitList"></span></p>
            </div>
        </div>
    </div>
</div>

<script>
let walletAddress = null;
const officialWallet = "YOUR_SIPP_WALLET_ADDRESS_HERE"; // Replace with your wallet
const gridSize = 16;
const pixelSize = 20;

// traits definition
const traitPool = {
    eyes: ["Normal","Laser","Angry","Sleepy","Heart","Cyclops","Glitch"],
    mouth: ["Smile","Frown","Grin","Ooo","Tongue","Snarl","Weird"],
    hair: ["None","Spiky","Afro","Mohawk","Long","Short","Rainbow"],
    accessory: ["None","Hat","Glasses","Earring","Crown","Headphone","Halo"],
    background: ["Blue","Purple","Red","Green","Yellow","Glitch","Neon"],
    rare: ["Golden Glow","Pixel Halo","Glitch Aura","Rainbow Spark"]
};

// simple hash from string
function hashCode(str) {
    let hash=0;
    for(let i=0;i<str.length;i++){
        hash = str.charCodeAt(i) + ((hash<<5)-hash);
        hash |=0;
    }
    return Math.abs(hash);
}

// pick traits deterministically from wallet
function pickTraits(addr){
    const h = hashCode(addr);
    return {
        eyes: traitPool.eyes[h%traitPool.eyes.length],
        mouth: traitPool.mouth[(h>>2)%traitPool.mouth.length],
        hair: traitPool.hair[(h>>4)%traitPool.hair.length],
        accessory: traitPool.accessory[(h>>6)%traitPool.accessory.length],
        background: traitPool.background[(h>>8)%traitPool.background.length],
        rare: traitPool.rare[(h>>10)%traitPool.rare.length]
    };
}

// generate pixel art
function generatePixelArt(addr){
    const canvas = document.getElementById("pixelCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = gridSize*pixelSize;
    canvas.height = gridSize*pixelSize;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const traits = pickTraits(addr);
    document.getElementById("traitList").textContent = `${traits.eyes}, ${traits.mouth}, ${traits.hair}, ${traits.accessory}, ${traits.background}${traits.rare?" â€¢ "+traits.rare:""}`;

    // simple color mapping per trait
    const colorMap = {
        "Normal":"#E0E0E0","Laser":"#FF0000","Angry":"#880000","Sleepy":"#888888","Heart":"#FF69B4","Cyclops":"#00FFFF","Glitch":"#FF00FF",
        "Smile":"#FFFFFF","Frown":"#AAAAAA","Grin":"#FFD700","Ooo":"#FFA500","Tongue":"#FF69B4","Snarl":"#880000","Weird":"#44FF44",
        "None":"#0B0F1A","Spiky":"#FFCC00","Afro":"#663300","Mohawk":"#FF00FF","Long":"#8800FF","Short":"#4444FF","Rainbow":"#FF77FF",
        "Hat":"#00FFFF","Glasses":"#FFFFFF","Earring":"#FFD700","Crown":"#FFCC00","Headphone":"#AA00FF","Halo":"#FFFF00",
        "Blue":"#1E3A8A","Purple":"#7C5CFF","Red":"#DC2626","Green":"#16A34A","Yellow":"#FACC15","Glitch":"#FF00FF","Neon":"#4DEEEA",
        "Golden Glow":"#FFD700","Pixel Halo":"#FFFF00","Glitch Aura":"#FF00FF","Rainbow Spark":"#FF77FF"
    };

    for(let y=0;y<gridSize;y++){
        for(let x=0;x<gridSize;x++){
            // random-ish based on wallet + position
            const seed = hashCode(addr + x + "," + y) % 100;
            if(seed>30){
                let color = colorMap[traits.background];
                if(seed>70) color = colorMap[traits.rare]; 
                ctx.fillStyle = color;
                ctx.fillRect(x*pixelSize,y*pixelSize,pixelSize,pixelSize);
                ctx.strokeStyle='rgba(0,0,0,0.05)';
                ctx.strokeRect(x*pixelSize,y*pixelSize,pixelSize,pixelSize);
            }
        }
    }
}

// connect solflare
async function connectSolflare(){
    if(!window.solflare){
        alert("Install Solflare!");
        window.open("https://solflare.com","_blank");
        return;
    }
    await window.solflare.connect();
    walletAddress = window.solflare.publicKey.toString();
    document.getElementById("walletAddress").textContent = walletAddress;
    document.getElementById("notConnected").style.display="none";
    document.getElementById("connected").style.display="block";
}

// simulate $1 transaction
async function pay(amount){
    try{
        if(!walletAddress) return alert("Connect wallet first");
        const transaction = {
            to: officialWallet,
            lamports: amount*1000000000 // 1 SOL = 1e9 lamports; here we assume 1$=0.0003 SOL as example
        };
        // use Solflare requestTransfer or SystemProgram here
        alert(`Simulated $${amount} transfer to SIPP wallet`);
        return true;
    }catch(e){ console.error(e); return false;}
}

// event listeners
document.getElementById("connectSolflareBtn").addEventListener("click",connectSolflare);
document.getElementById("payBtn").addEventListener("click", async ()=>{
    const paid = await pay(1);
    if(paid){
        document.getElementById("pixelContainer").style.display="flex";
        generatePixelArt(walletAddress);
    }
});
document.getElementById("regenerateBtn").addEventListener("click", async ()=>{
    const paid = await pay(0.5);
    if(paid){
        generatePixelArt(walletAddress+"regen"+Math.random());
    }
});
document.getElementById("downloadBtn").addEventListener("click",()=>{
    const canvas = document.getElementById("pixelCanvas");
    const link = document.createElement("a");
    link.download = `SIPP-${walletAddress.slice(0,6)}.png`;
    link.href = canvas.toDataURL();
    link.click();
});
</script>
</body>
</html>