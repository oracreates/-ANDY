<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sipp - Your Pixels, Your Identity</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { margin: 0; padding: 0; }
.pixelated {
    image-rendering: pixelated;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;
}
</style>
</head>
<body>
<div id="app" class="min-h-screen bg-gradient-to-br from-yellow-200 via-pink-200 to-purple-300 flex items-center justify-center p-4">
    <div class="max-w-2xl w-full bg-white/20 backdrop-blur-lg rounded-2xl shadow-2xl p-8 border border-white/30">

        <!-- Landing / Input -->
        <div id="landing" class="flex flex-col items-center space-y-6">
            <div class="text-center mb-6">
                <h1 class="text-5xl font-bold text-purple-900 mb-1">Sipp</h1>
                <p class="text-purple-800 italic text-lg">Your pixels, your identity</p>
            </div>

            <input id="walletInput" type="text" placeholder="Paste your wallet address here"
                class="w-full max-w-md px-4 py-3 rounded-lg border border-purple-400 text-purple-900 font-mono" />

            <button id="generateBtn"
                class="px-8 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
                Reveal Your Sipp
            </button>

            <p id="inputError" class="text-red-700 text-sm mt-2 hidden">Please enter a valid wallet address.</p>
        </div>

        <!-- Connected / Generated -->
        <div id="generated" class="space-y-6" style="display:none;">
            <div class="bg-white/10 rounded-lg p-4 border border-white/20">
                <p class="text-sm text-purple-800 mb-1">Wallet Address</p>
                <p id="walletAddress" class="text-purple-900 font-mono text-sm break-all"></p>
            </div>

            <div class="flex flex-col items-center space-y-4">
                <div class="bg-white/10 p-6 rounded-xl border-4 border-white/20 shadow-2xl">
                    <canvas id="pixelCanvas" class="rounded-lg pixelated"></canvas>
                </div>

                <div id="sippFacts" class="bg-white/10 rounded-lg p-4 border border-white/20">
                    <p>Sipp ID: <span id="sippId"></span></p>
                    <p>Origin: Wallet-bound</p>
                    <p>Status: Unchanged</p>
                </div>

                <div id="downloadLinkContainer" class="w-full bg-white/10 rounded-lg p-4 border border-white/20" style="display: none;">
                    <p class="text-sm text-purple-800 mb-2 font-semibold">Your NFT Download Link:</p>
                    <div class="flex gap-2">
                        <input id="downloadLinkInput" type="text" readonly class="flex-1 px-3 py-2 bg-white/50 rounded border border-purple-300 text-purple-900 font-mono text-xs break-all" />
                        <button id="copyLinkBtn" class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white font-semibold rounded transition-all duration-200">
                            Copy
                        </button>
                    </div>
                    <p class="text-xs text-purple-700 mt-2">ðŸ“‹ Copy this link and paste it in Chrome/Safari address bar to download your Sipp!</p>
                </div>

                <button id="downloadBtn"
                    class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200">
                    Generate Download Link
                </button>

                <!-- New Seedless Wallet Button -->
                <button id="seedlessBtn"
                    class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200">
                    Create Seedless Wallet
                </button>

                <button id="regenerateBtn" class="text-sm text-purple-800 hover:text-purple-700 underline">
                    Regenerate
                </button>

                <button id="supportBuildBtn"
                    class="px-6 py-3 bg-yellow-500 hover:bg-yellow-600 text-white font-semibold rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200">
                    Support the Build
                </button>
            </div>
        </div>

    </div>
</div>

<script>
// --- Globals ---
let walletAddress = null;

// --- Event Listeners ---
document.getElementById('generateBtn').addEventListener('click', () => {
    const input = document.getElementById('walletInput').value.trim();
    if(input.length < 32){ // simple validation
        document.getElementById('inputError').style.display = 'block';
        return;
    }
    document.getElementById('inputError').style.display = 'none';
    walletAddress = input;
    document.getElementById('walletAddress').textContent = walletAddress;
    document.getElementById('sippId').textContent = '#' + Math.floor(Math.random()*10000).toString(16).toUpperCase();
    document.getElementById('landing').style.display = 'none';
    document.getElementById('generated').style.display = 'block';
    generatePixelArt(walletAddress);
});

document.getElementById('regenerateBtn').addEventListener('click', () => {
    if(walletAddress) generatePixelArt(walletAddress);
});

document.getElementById('downloadBtn').addEventListener('click', downloadNFT);

document.getElementById('copyLinkBtn').addEventListener('click', () => {
    const linkInput = document.getElementById('downloadLinkInput');
    linkInput.select();
    linkInput.setSelectionRange(0,99999);
    document.execCommand('copy');
    alert('Copied link!');
});

// --- New Seedless Wallet Integration ---
document.getElementById('seedlessBtn').addEventListener('click', () => {
    if(!walletAddress){
        alert("Generate your Sipp first!");
        return;
    }
    // open seedless wallet page in new tab with walletAddress as query param
    const seedlessUrl = `https://seedless.up.railway.app?address=${walletAddress}`;
    window.open(seedlessUrl, "_blank");
});

// --- Pixel Art Logic ---
class Random { constructor(seed){ this.seed=seed; } next(){ this.seed=(this.seed*9301+49297)%233280; return this.seed/233280; } range(min,max){ return Math.floor(this.next()*(max-min+1))+min; } pick(arr){ return arr[Math.floor(this.next()*arr.length)]; } chance(p){ return this.next()<p; } }
function generatePixelArt(address){
    const canvas = document.getElementById('pixelCanvas');
    const ctx = canvas.getContext('2d');
    const gridSize=24, pixelSize=16;
    canvas.width=gridSize*pixelSize; canvas.height=gridSize*pixelSize;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    let seed=0; for(let i=0;i<address.length;i++) seed=address.charCodeAt(i)+((seed<<5)-seed);
    const rng=new Random(Math.abs(seed));

    const bgHue=rng.range(0,360);
    const bgGradient=ctx.createLinearGradient(0,0,0,canvas.height);
    bgGradient.addColorStop(0,`hsl(${bgHue},70%,60%)`);
    bgGradient.addColorStop(1,`hsl(${(bgHue+30)%360},70%,50%)`);
    ctx.fillStyle=bgGradient; ctx.fillRect(0,0,canvas.width,canvas.height);

    const skinColors=['#8d5524','#c68642','#e0ac69','#f1c27d','#ffdbac','#2ecc71','#9b59b6','#3498db','#e74c3c','#f39c12','#95a5a6','#34495e','#1abc9c','#ff6b9d','#c0392b'];
    const skin=rng.pick(skinColors);

    const headW=10, headH=10, startX=Math.floor((gridSize-headW)/2), startY=4;
    for(let y=0;y<headH;y++) for(let x=0;x<headW;x++){ const mx=x<headW/2?x:headW-1-x; if(y<8){ if((y===0&&mx>=2&&mx<=3)||(y===1&&mx>=1&&mx<=4)||(y>=2&&y<=7&&mx>=0&&mx<=4)) drawPixel(ctx,startX+x,startY+y,skin,pixelSize); } }

    const shoulderStart=startY+headH;
    for(let y=0;y<4;y++) for(let x=0;x<16;x++){ const sx=startX-3+x,sy=shoulderStart+y; if(y===0&&x>=2&&x<=13) drawPixel(ctx,sx,sy,skin,pixelSize); else if(y===1&&x>=1&&x<=14) drawPixel(ctx,sx,sy,darkenColor(skin,15),pixelSize); else if(y>=2&&x>=0&&x<=15) drawPixel(ctx,sx,sy,darkenColor(skin,25),pixelSize); }

    const hairColors=['#2c1810','#8b4513','#daa520','#ff6347','#00ff00','#ff00ff','#00ffff','#ffff00'];
    const hair=rng.pick(hairColors);
    for(let x=0;x<10;x++) if(rng.chance(0.7)) drawPixel(ctx,startX+x,startY-1,hair,pixelSize);
    drawPixel(ctx,startX+2,startY+3,'#000',pixelSize); drawPixel(ctx,startX+7,startY+3,'#000',pixelSize);
    for(let x=2;x<8;x++) drawPixel(ctx,startX+x,startY+6,'#000',pixelSize);
}

// helpers
function drawPixel(ctx,x,y,color,size){ctx.fillStyle=color;ctx.fillRect(x*size,y*size,size,size);}
function darkenColor(color,p){const n=parseInt(color.replace('#',''),16);const a=Math.round(2.55*p);const R=Math.max(0,Math.min(255,(n>>16)-a)),G=Math.max(0,Math.min(255,(n>>8&0x00FF)-a)),B=Math.max(0,Math.min(255,(n&0x0000FF)-a));return '#'+(0x1000000+R*0x10000+G*0x100+B).toString(16).slice(1);}
function dataURLtoBlob(dataurl){const arr=dataurl.split(','), mime=arr[0].match(/:(.*?);/)[1];let n=bstr.length;const u8arr=new Uint8Array(n);while(n--) u8arr[n]=bstr.charCodeAt(n);return new Blob([u8arr],{type:mime});}

// download NFT
function downloadNFT(){
    const canvas=document.getElementById('pixelCanvas');
    const imageData=canvas.toDataURL('image/png');
    const blob=dataURLtoBlob(imageData);
    const url=URL.createObjectURL(blob);
    document.getElementById('downloadLinkInput').value=url;
    document.getElementById('downloadLinkContainer').style.display='block';
}
</script>
</body>
</html>