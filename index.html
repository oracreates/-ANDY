<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sipp Voxel Demo</title>
<style>
  body { margin: 0; overflow: hidden; }
  #info { position: absolute; top: 10px; left: 10px; color: #fff; font-family: sans-serif; z-index: 1; }
</style>
</head>
<body>
<div id="info">Use WASD to move, Space to jump</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/PointerLockControls.js"></script>
<script>
// --- Scene Setup ---
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb); // sky blue

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,2,5);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// --- Lights ---
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5,10,7);
scene.add(light);

// --- Player ---
const player = new THREE.Mesh(new THREE.BoxGeometry(1,2,1), new THREE.MeshStandardMaterial({color:0xff5555}));
player.position.y = 1;
scene.add(player);

// --- Ground ---
const groundSize = 20;
const groundGeometry = new THREE.BoxGeometry(1,1,1);
for(let x=-groundSize/2;x<groundSize/2;x++){
  for(let z=-groundSize/2;z<groundSize/2;z++){
    const color = new THREE.Color(`hsl(${Math.random()*50+100},70%,50%)`);
    const cube = new THREE.Mesh(groundGeometry, new THREE.MeshStandardMaterial({color}));
    cube.position.set(x,0,z);
    scene.add(cube);
  }
}

// --- Some random blocks ---
for(let i=0;i<50;i++){
  const block = new THREE.Mesh(groundGeometry, new THREE.MeshStandardMaterial({color:Math.random()*0xffffff}));
  block.position.set(Math.floor(Math.random()*groundSize - groundSize/2),1,Math.floor(Math.random()*groundSize - groundSize/2));
  scene.add(block);
}

// --- Controls ---
const controls = new THREE.PointerLockControls(camera, document.body);
document.body.addEventListener('click', ()=>controls.lock());

const keys = {};
document.addEventListener('keydown',(e)=>keys[e.code]=true);
document.addEventListener('keyup',(e)=>keys[e.code]=false);

let velocity = new THREE.Vector3();
const speed = 0.1;
let canJump = false;

// --- Animate ---
function animate(){
  requestAnimationFrame(animate);

  // Movement
  const dir = new THREE.Vector3();
  if(keys['KeyW']) dir.z -=1;
  if(keys['KeyS']) dir.z +=1;
  if(keys['KeyA']) dir.x -=1;
  if(keys['KeyD']) dir.x +=1;
  dir.normalize();

  // Apply movement
  player.position.x += dir.x*speed;
  player.position.z += dir.z*speed;

  // Gravity & Jump
  velocity.y -= 0.01; // gravity
  player.position.y += velocity.y;
  if(player.position.y <1){
    velocity.y =0;
    player.position.y =1;
    canJump = true;
  }

  if(keys['Space'] && canJump){
    velocity.y = 0.2;
    canJump = false;
  }

  // Camera follows player
  camera.position.x = player.position.x;
  camera.position.z = player.position.z +5;
  camera.position.y = player.position.y +2;
  camera.lookAt(player.position);

  renderer.render(scene, camera);
}
animate();

// --- Handle Resize ---
window.addEventListener('resize',()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>