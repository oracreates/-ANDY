<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sipp â€” Your pixels, your identity</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  canvas {
    image-rendering: pixelated;
  }
</style>
</head>

<body class="min-h-screen flex items-center justify-center bg-yellow-50">
<div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md text-center">

  <h1 class="text-4xl font-bold mb-1">Sipp</h1>
  <p class="text-gray-600 mb-6">Your pixels, your identity</p>

  <button id="connectBtn"
    class="px-6 py-3 bg-black text-white rounded-xl hover:scale-105 transition">
    Connect Wallet
  </button>

  <div id="connected" class="hidden mt-6">
    <canvas id="pfp" width="256" height="256"
      class="mx-auto border-4 border-black rounded-xl"></canvas>

    <button id="download"
      class="mt-4 px-5 py-2 bg-green-500 text-white rounded-lg">
      Download
    </button>
  </div>

</div>

<script>
let wallet = null;

// ---------- WALLET ----------
document.getElementById("connectBtn").onclick = async () => {
  if (!window.solflare) {
    alert("Install Solflare");
    return;
  }
  await window.solflare.connect();
  wallet = window.solflare.publicKey.toString();
  document.getElementById("connected").classList.remove("hidden");
  generateSipp(wallet);
};

// ---------- SEED ----------
function seedFromAddress(addr) {
  let h = 0;
  for (let i = 0; i < addr.length; i++) {
    h = addr.charCodeAt(i) + ((h << 5) - h);
  }
  return Math.abs(h);
}
function rand(seed, min, max) {
  const x = Math.sin(seed++) * 10000;
  return Math.floor((x - Math.floor(x)) * (max - min)) + min;
}

// ---------- DRAW ----------
function generateSipp(address) {
  const canvas = document.getElementById("pfp");
  const ctx = canvas.getContext("2d");
  const seed = seedFromAddress(address);

  ctx.clearRect(0,0,256,256);

  // Background
  const bgColors = ["#fde68a","#bfdbfe","#fecaca","#bbf7d0","#e9d5ff"];
  ctx.fillStyle = bgColors[seed % bgColors.length];
  ctx.fillRect(0,0,256,256);

  // Head
  const headColor = `hsl(${seed % 360},70%,65%)`;
  ctx.fillStyle = headColor;
  ctx.fillRect(64,80,128,128);

  // Eyes
  ctx.fillStyle = "#000";
  const eyeType = seed % 6;
  if (eyeType === 0) {
    ctx.fillRect(92,120,12,12);
    ctx.fillRect(152,120,12,12);
  }
  if (eyeType === 1) {
    ctx.fillRect(90,118,20,20);
    ctx.fillRect(146,118,20,20);
  }
  if (eyeType === 2) {
    ctx.fillRect(100,122,8,8);
    ctx.fillRect(148,122,8,8);
  }
  if (eyeType === 3) {
    ctx.fillRect(92,120,12,12);
    ctx.fillRect(152,120,12,12);
    ctx.fillRect(122,112,12,12);
  }
  if (eyeType === 4) {
    ctx.fillRect(92,120,12,4);
    ctx.fillRect(152,120,12,4);
  }
  if (eyeType === 5) {
    ctx.fillRect(96,120,6,12);
    ctx.fillRect(154,120,6,12);
  }

  // Mouth
  const mouthType = seed % 5;
  if (mouthType === 0) ctx.fillRect(112,156,32,6);
  if (mouthType === 1) ctx.fillRect(120,152,16,16);
  if (mouthType === 2) ctx.fillRect(112,156,32,12);
  if (mouthType === 3) {
    ctx.fillRect(116,156,24,6);
    ctx.fillRect(122,162,12,6);
  }
  if (mouthType === 4) {
    ctx.fillRect(112,156,32,4);
    ctx.fillRect(112,162,4,4);
    ctx.fillRect(140,162,4,4);
  }

  // Accessory (chance)
  if (seed % 4 === 0) {
    ctx.strokeStyle = "#000";
    ctx.lineWidth = 4;
    ctx.strokeRect(80,112,40,32);
    ctx.strokeRect(136,112,40,32);
    ctx.beginPath();
    ctx.moveTo(120,128);
    ctx.lineTo(136,128);
    ctx.stroke();
  }
}

// ---------- DOWNLOAD ----------
document.getElementById("download").onclick = () => {
  const c = document.getElementById("pfp");
  const a = document.createElement("a");
  a.href = c.toDataURL();
  a.download = "sipp.png";
  a.click();
};
</script>
</body>
</html>