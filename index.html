<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Solana Wallet PFP Generator</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { margin: 0; }
  canvas { image-rendering: pixelated; }
</style>
</head>

<body class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-6">

<div class="bg-white/10 backdrop-blur-xl rounded-2xl p-8 shadow-2xl border border-white/20 max-w-xl w-full text-center">
  <h1 class="text-3xl font-bold text-white mb-2">Wallet PFP Generator</h1>
  <p class="text-purple-200 mb-6">Your wallet, your identity.</p>

  <button id="connectBtn"
    class="px-6 py-3 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-lg font-semibold hover:scale-105 transition">
    Connect Solflare
  </button>

  <div id="pfp" class="mt-6 hidden">
    <canvas id="canvas" width="320" height="320"
      class="mx-auto rounded-xl shadow-xl border-4 border-white/20"></canvas>

    <div class="flex justify-center gap-4 mt-4">
      <button id="regen"
        class="px-4 py-2 bg-indigo-500 text-white rounded-lg">Regenerate</button>
      <button id="download"
        class="px-4 py-2 bg-green-500 text-white rounded-lg">Download</button>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const SIZE = 20;
const GRID = 16;

let wallet = null;

// ---- WALLET (SOLFLARE ONLY) ----
document.getElementById("connectBtn").onclick = async () => {
  if (!window.solflare) {
    alert("Install Solflare Wallet");
    window.open("https://solflare.com", "_blank");
    return;
  }

  await window.solflare.connect();
  wallet = window.solflare.publicKey.toString();
  document.getElementById("pfp").classList.remove("hidden");
  generatePFP(wallet);
};

// ---- HASH ----
function hash(str) {
  let h = 0;
  for (let c of str) h = Math.imul(31, h) + c.charCodeAt(0);
  return Math.abs(h);
}

// ---- GENERATOR ----
function generatePFP(address) {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const seed = hash(address);
  const hue = seed % 360;

  const skin = `hsl(${hue},50%,65%)`;
  const dark = `hsl(${hue},40%,30%)`;
  const accent = `hsl(${(hue+80)%360},70%,55%)`;
  const laser = `hsl(0,100%,60%)`;

  const rareHalo = seed % 20 === 0;
  const crown = seed % 50 === 0;

  // ---- BACKGROUND ----
  ctx.fillStyle = rareHalo ? accent : "#111";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // ---- FACE MASK ----
  const mask = [
    "0011111100000000",
    "0111111110000000",
    "1111111111000000",
    "1111111111000000",
    "1111111111000000",
    "1111111111000000",
    "1111111111000000",
    "1111111111000000",
    "1111111111000000",
    "1111111111000000",
    "0111111110000000",
    "0011111100000000"
  ];

  mask.forEach((row,y)=>{
    for(let x=0;x<row.length/2;x++){
      if(row[x]==="1"){
        ctx.fillStyle = skin;
        ctx.fillRect(x*SIZE,y*SIZE,SIZE,SIZE);
        ctx.fillRect((GRID-1-x)*SIZE,y*SIZE,SIZE,SIZE);
      }
    }
  });

  // ---- EYES ----
  const eyeType = seed % 4;
  const eyeY = 5;
  const eyeX = 4;

  ctx.fillStyle = eyeType === 1 ? laser : dark;

  if (eyeType === 2) {
    ctx.fillRect(eyeX*SIZE,eyeY*SIZE,SIZE*2,SIZE/2);
    ctx.fillRect((GRID-eyeX-2)*SIZE,eyeY*SIZE,SIZE*2,SIZE/2);
  } else {
    ctx.fillRect(eyeX*SIZE,eyeY*SIZE,SIZE,SIZE);
    ctx.fillRect((GRID-eyeX-1)*SIZE,eyeY*SIZE,SIZE,SIZE);
  }

  // ---- MOUTH ----
  const mood = seed % 3;
  ctx.fillStyle = dark;
  if (mood === 0)
    ctx.fillRect(7*SIZE,9*SIZE,2*SIZE,SIZE/2);
  if (mood === 1)
    ctx.fillRect(7*SIZE,9*SIZE,2*SIZE,SIZE/4);
  if (mood === 2)
    ctx.fillRect(7*SIZE,10*SIZE,2*SIZE,SIZE/2);

  // ---- ACCESSORIES ----
  if (seed % 3 === 0) {
    ctx.fillStyle = accent;
    ctx.fillRect(3*SIZE,8*SIZE,SIZE/2,SIZE);
  }

  if (seed % 7 === 0) {
    ctx.fillStyle = dark;
    ctx.fillRect(8*SIZE,6*SIZE,SIZE/4,2*SIZE);
  }

  if (seed % 9 === 0) {
    ctx.strokeStyle = dark;
    ctx.lineWidth = 2;
    ctx.strokeRect(3*SIZE,5*SIZE,3*SIZE,2*SIZE);
    ctx.strokeRect(10*SIZE,5*SIZE,3*SIZE,2*SIZE);
  }

  // ---- RARE CROWN ----
  if (crown) {
    ctx.fillStyle = "gold";
    ctx.fillRect(5*SIZE,2*SIZE,6*SIZE,SIZE);
  }
}

// ---- BUTTONS ----
document.getElementById("regen").onclick = ()=>generatePFP(wallet);
document.getElementById("download").onclick = ()=>{
  const a = document.createElement("a");
  a.download = "wallet-pfp.png";
  a.href = canvas.toDataURL();
  a.click();
};
</script>
</body>
</html>